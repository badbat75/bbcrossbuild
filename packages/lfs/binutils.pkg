# binutils
PKG_URL="https://ftp.gnu.org/gnu/binutils/binutils-${BINUTILS_VER}.tar.bz2"
PKG_DEPS="lfs/libgmp lfs/libmpfr lfs/libmpc lfs/libisl"
case ${BINUTILS_VER} in
	2.40)
		PKG_VER=2.40+e310116ffd9
		PATCHES=binutils/binutils_2.40+e310116ffd9.patch
		;;
	2.39)
		PKG_VER=2.39+4e3ee240162
		PATCHES=binutils/binutils_2.39+4e3ee240162.patch
		;;
	*)
		PKG_VER=${BINUTILS_VER}
		;;
esac
BUILD_PROCESS=configmake
STD_CONF_FLAGS=0
CONF_FLAGS="--prefix=${INSTALL_PREFIX} --libdir=${INSTALL_LIBDIR}${INSTALL_LIBSUFFIX} --with-sysroot=/ --with-build-sysroot=\${SYSROOT} \
	--build=${BARCH} --host=${HARCH} --target=${HARCH} \
	--disable-werror \
	--enable-shared --enable-static \
	--enable-gold=default --enable-ld --enable-gprofng=yes --enable-lto \
	--enable-new-dtags --disable-rpath --enable-threads=yes --enable-plugins --enable-64-bit-bfd \
	--enable-compressed-debug-sections=all --enable-separate-code=yes --enable-plugins"
CONF_FLAGS+=" --with-system-zlib"
CONF_FLAGS+=" --with-mpc-include=\${SYSROOT}${INSTALL_INCLUDEDIR} --with-mpc-lib=\${SYSROOT}${INSTALL_LIBDIR}${INSTALL_LIBSUFFIX}"
CONF_FLAGS+=" --with-mpfr-include=\${SYSROOT}${INSTALL_INCLUDEDIR} --with-mpfr-lib=\${SYSROOT}${INSTALL_LIBDIR}${INSTALL_LIBSUFFIX}"
CONF_FLAGS+=" --with-gmp-include=\${SYSROOT}${INSTALL_INCLUDEDIR} --with-gmp-lib=\${SYSROOT}${INSTALL_LIBDIR}${INSTALL_LIBSUFFIX}"
CONF_FLAGS+=" --with-isl-include=\${SYSROOT}${INSTALL_INCLUDEDIR} --with-isl-lib=\${SYSROOT}${INSTALL_LIBDIR}${INSTALL_LIBSUFFIX}"
PKG_MAKETARGETS="all,install"
PKG_MAKEVARS="STAGE_CC_WRAPPER=\"${CCWRAPPER}\""
PKG_MAKEVARS+="AR_FOR_TARGET=\"\${AR}\""
PKG_MAKEVARS+="NM_FOR_TARGET=\"\${NM}\""
PKG_MAKEVARS+="RANLIB_FOR_TARGET=\"\${RANLIB}\""
PKG_TOOLCHAIN=gnu
PKG_LDFLAGS="-s"

case ${BINUTILS_VER} in
	2.3*)
		CONF_ENV="env -u CPP -u CPPFLAGS"
		PKG_MAKEENV="env -u CPP -u CPPFLAGS"
	;;
esac

PKG_PREBUILD="sed '/^AM_CFLAGS_FOR_BUILD/ s/\\\$(ZSTD_CFLAGS)//' -i binutils/Makefile.in"