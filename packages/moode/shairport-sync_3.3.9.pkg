# shairport-sync_3.3.9
PKG_URL="https://github.com/mikebrady/shairport-sync/archive/refs/tags/3.3.9.tar.gz"
BUILD_PROCESS=configmake
AUTOCONF=1
CONF_FLAGS="--with-dummy --with-stdout --with-pipe --with-soxr --with-metadata --with-avahi \
		--with-alsa --with-convolution --with-piddir=/run/shairport-sync --without-configfiles \
		--without-libdaemon --with-mqtt-client --with-systemd --with-dbus-interface"
INST_CMD=install-strip
PKG_DEPS="moode/alsa-lib_1.2.6.1 moode/libsndfile_1.0.31 raspbian/libsoxr_0.1.3-1 raspbian/libconfig_1.5-0.4 raspbian/mosquitto_2.0.11-1"
PKG_PREBUILD="sed -i '/AC_PROG_INSTALL/a AM_PROG_AR' configure.ac
	sed -i 's/^\tgetent/#\tgetent/g' Makefile.am
	sed -i 's| org.gnome.ShairportSync.xml| \$(VPATH)/org.gnome.ShairportSync.xml|g' Makefile.am"
PKG_POSTBUILD="install -d ${PKG_PKGPATH}/usr/local/bin &&
install -d ${PKG_PKGPATH}/usr/local/etc &&
ln -fs /usr/bin/shairport-sync ${PKG_PKGPATH}/usr/local/bin/shairport-sync &&
ln -fs /etc/shairport-sync.conf ${PKG_PKGPATH}/usr/local/etc/shairport-sync.conf"
PKG_CONFIG_SYSROOT_DIR=${DISTOS_PATH}

case x${WITH_ALAC} in
	xyes|x1)
		CONF_FLAGS+=" --with-apple-alac"
		PKG_DEPS+=" moode/alac_0.0.7+5d6d836"
	;;
esac

case x${WITH_SSL} in
	xmbedtls) ### Build with MBEDTLS
		CONF_FLAGS+=" --with-ssl=mbedtls"
		PKG_DEPS+=" raspbian/mbedtls_2.16.9-0.1"
		PKG_LDFLAGS="-lssl -lcrypto"
	;;
	*) ### Build with OpenSSL
		CONF_FLAGS+=" --with-ssl=openssl"
	;;
esac

# Dependencies:
# libpopt-dev avahi-daemon libavahi-client-dev glib2.0
