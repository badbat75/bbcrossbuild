# Build recipe for moode mediacenter

RASPBIAN_IMAGE=2021-10-30-raspios-bullseye-armhf-lite
RASPBIAN_URL=https://downloads.raspberrypi.org/raspios_lite_armhf/images/raspios_lite_armhf-2021-11-08/

#TOOLCHAIN=llvm

## Enable shared libraries (default) but disable static ones
BUILD_LIBSHARED=1
BUILD_LIBSTATIC=0

## Enable LTO both for kernel and applications
LTOENABLE=thin
KERN_LTOENABLE=thin

LLVM_POLLY_FEATURES="polly vectorizer"

## Set default sysroot pkg-config library path
#PKG_CONFIG_SYSROOT_DIR=${BIN_PATH}

mount_tag distos --url "${RASPBIAN_URL}${RASPBIAN_IMAGE}.zip" --imgfile "${RASPBIAN_IMAGE}.img" --mountlist "2:/ 1:/boot" --resize 2:4G
if [ -z ${SKIP_DISTOS_APTS} ]
then
	run_on_root_dir distos root "sed -i 's/#deb-src/deb-src/g' /etc/apt/sources.list"
	#run_on_root_dir distos root "apt-get update --allow-releaseinfo-change"
	#run_on_root_dir distos root "DEBIAN_FRONTEND=noninteractive apt-get -y dist-upgrade"
	#run_on_root_dir distos root "DEBIAN_FRONTEND=noninteractive apt-get -y install libc6-dev libcups2-dev libpipewire-0.3-dev"
fi
prepare_sysroot

#create_sysroot http://<url>/<rootfs.tar.gz>
setup_gcc_v2
setup_llvm
#setup_rust
#setup_python 3.9.8

#create_key_sscertificate
#generate_ssh_keys --install binaries

#clean_project

#inject_into_mount_tag distos gcclibs

pause
unmount_tag distos
